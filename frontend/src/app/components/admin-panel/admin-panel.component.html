<div class="admin-page container">
  <div class="admin-header">
    <h1 class="section-title">Panel de Administración</h1>
    <div class="admin-header-actions">
      <button class="btn btn-ghost" (click)="gotoDashboard()">Ir a Dashboard</button>
      <button class="btn btn-ghost" (click)="logout()">Cerrar Sesión</button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs-bar">
    <div class="tabs">
      <button class="tab" (click)="setTab('users')" [class.active]="activeTab==='users'">Gestión de Usuarios</button>
      <button class="tab" (click)="setTab('rooms')" [class.active]="activeTab==='rooms'">Gestión de Habitaciones</button>
      <button class="tab" (click)="setTab('hotels')" [class.active]="activeTab==='hotels'">Gestión de Hoteles</button>
    </div>
  </div>

  <div *ngIf="successMessage" class="alert success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert error">{{ errorMessage }}</div>

  <!-- Usuarios Tab -->
  <div *ngIf="activeTab==='users'">
    <div *ngIf="isLoading" class="loading-placeholder">Cargando usuarios...</div>

    <div *ngIf="!isLoading" class="grid-2">
      <!-- Lista de usuarios -->
      <div class="card card-scroll">
        <h3 class="section-sub">Usuarios</h3>
        <div *ngFor="let user of users"
             (click)="selectUser(user)"
             [ngClass]="{'user-list-item': true, 'selected': selectedUser?.id === user.id}">
          <strong>{{ user.fullName }}</strong><br>
          <span class="muted">{{ user.email }}</span><br>
          <small class="muted">Rol: {{ user.role }} | Estado: {{ user.isActive ? 'Activo' : 'Inactivo' }}</small>
        </div>
      </div>

      <!-- Detalles y edición -->
      <div class="card">
        <h3 class="section-sub">Detalles del Usuario</h3>
        <div *ngIf="!selectedUser" class="muted">
          Selecciona un usuario para ver detalles
          <div style="margin-top:12px">
            <button class="btn btn-primary" (click)="toggleCreateForm()">+ Crear Usuario</button>
          </div>
        </div>

        <div *ngIf="showCreateForm" class="spaced-block">
          <h4>Crear Usuario</h4>
          <div class="spaced-block">
            <label>Email:</label>
            <input type="email" [(ngModel)]="createForm.email" class="form-control" />
          </div>
          <div class="spaced-block">
            <label>Nombre completo:</label>
            <input type="text" [(ngModel)]="createForm.fullName" class="form-control" />
          </div>
          <div class="spaced-block">
            <label>Contraseña:</label>
            <input type="password" [(ngModel)]="createForm.password" class="form-control" />
          </div>
          <div class="spaced-block">
            <label>Rol:</label>
            <select [(ngModel)]="createForm.role" class="form-control">
              <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
            </select>
          </div>
          <div class="action-row">
            <button class="btn btn-primary" (click)="createUser()">Crear</button>
            <button class="btn btn-ghost" (click)="toggleCreateForm()">Cancelar</button>
          </div>
        </div>

        <div *ngIf="selectedUser">
          <div *ngIf="editingId !== selectedUser.id">
            <!-- Vista de detalles -->
            <div class="spaced-block">
              <label><strong>Email:</strong></label>
              <p>{{ selectedUser.email }}</p>
            </div>
            <div class="spaced-block">
              <label><strong>Nombre completo:</strong></label>
              <p>{{ selectedUser.fullName }}</p>
            </div>
            <div class="spaced-block">
              <label><strong>Rol:</strong></label>
              <p>{{ selectedUser.role }}</p>
            </div>
            <div class="spaced-block">
              <label><strong>Estado:</strong></label>
              <p>{{ selectedUser.isActive ? 'Activo' : 'Inactivo' }}</p>
            </div>

            <div class="action-row">
              <button class="btn btn-ghost" (click)="startEdit(selectedUser)">Editar</button>
              <button class="btn" (click)="toggleActive(selectedUser)" [ngClass]="selectedUser.isActive ? 'btn-danger' : 'btn-success'">
                {{ selectedUser.isActive ? 'Desactivar' : 'Activar' }}
              </button>
              <button class="btn btn-danger" (click)="deleteUser(selectedUser)">Eliminar</button>
            </div>
          </div>

            <div *ngIf="editingId === selectedUser.id">
            <!-- Formulario de edición -->
            <div class="spaced-block">
              <label>Email:</label>
              <input name="editEmail" type="email" [(ngModel)]="editForm.email" class="form-control" />
            </div>
            <div class="spaced-block">
              <label>Nombre completo:</label>
              <input name="editFullName" type="text" [(ngModel)]="editForm.fullName" class="form-control" />
            </div>
            <div class="spaced-block">
              <label>Rol:</label>
              <select name="editRole" [(ngModel)]="editForm.role" class="form-control">
                <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
              </select>
            </div>
            <div class="action-row">
              <button class="btn btn-success" (click)="saveEdit(selectedUser)">Guardar</button>
              <button class="btn btn-ghost" (click)="cancelEdit()">Cancelar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Habitaciones Tab -->
  <div *ngIf="activeTab==='rooms'">
    <div>
      <app-room-manager></app-room-manager>
    </div>
  </div>

  <!-- Hoteles Tab -->
  <div *ngIf="activeTab==='hotels'">
    <div>
      <app-hotel-manager></app-hotel-manager>
    </div>
  </div>
</div>
