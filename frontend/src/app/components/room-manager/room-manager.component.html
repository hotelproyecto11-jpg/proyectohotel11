<div class="room-manager container">
  <div class="d-flex space-between" style="margin-bottom:15px;align-items:center;">
    <h3>Gestión de Habitaciones</h3>
    <button class="btn" (click)="toggleForm()">{{ showForm ? 'Cancelar' : '+ Agregar Habitación' }}</button>
  </div>

  <div *ngIf="successMessage" style="color: green; padding: 10px; background: #e8f5e9; margin-bottom: 10px;">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" style="color: red; padding: 10px; background: #ffebee; margin-bottom: 10px;">
    {{ errorMessage }}
  </div>

  <!-- Formulario de creación -->
  <div *ngIf="showForm" class="card" style="margin-bottom:20px;padding:16px;">
    <h4>Nueva Habitación</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
      <div>
        <label>Hotel *</label>
        <select [(ngModel)]="newRoom.hotelId">
          <option *ngFor="let h of hotels" [value]="h.id">{{ h.name }}</option>
        </select>
      </div>
      <div>
        <label>Número de Habitación *</label>
        <input type="text" [(ngModel)]="newRoom.roomNumber" placeholder="ej: 101" />
      </div>
      <div>
        <label>Tipo de Habitación *</label>
        <select [(ngModel)]="newRoom.type">
          <option *ngFor="let type of roomTypes" [value]="type">{{ type }}</option>
        </select>
      </div>
      <div>
        <label>Capacidad (Personas) *</label>
        <input type="number" [(ngModel)]="newRoom.capacity" min="1" />
      </div>
      <div>
        <label>Precio Base (MXN) *</label>
        <input type="number" [(ngModel)]="newRoom.basePrice" min="0" />
      </div>
      <div>
        <label>Cantidad de Habitaciones</label>
        <input type="number" [(ngModel)]="newRoom.quantity" min="1" />
      </div>
      <div>
        <label>Metros Cuadrados</label>
        <input type="number" [(ngModel)]="newRoom.squareMeters" min="0" />
      </div>
      <div>
        <label>
          <input type="checkbox" [(ngModel)]="newRoom.hasBalcony" />
          ¿Tiene Balcón?
        </label>
      </div>
      <div>
        <label>
          <input type="checkbox" [(ngModel)]="newRoom.hasSeaView" />
          ¿Vista al Mar?
        </label>
      </div>
    </div>
    <div class="form-actions" style="margin-top:15px;">
      <button class="btn btn-primary" (click)="saveRoom()" style="margin-right:10px;">Guardar</button>
      <button class="btn" (click)="toggleForm()">Cancelar</button>
    </div>
  </div>

  <!-- Lista de habitaciones -->
  <div *ngIf="isLoading" style="text-align: center; padding: 20px;">
    Cargando habitaciones...
  </div>

  <div *ngIf="!isLoading && rooms.length > 0" style="overflow-x:auto;">
    <table class="data-table" style="width:100%;border-collapse:collapse;">
      <thead>
        <tr style="background: #f0f0f0;">
          <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Número</th>
          <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Tipo</th>
          <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Hotel</th>
          <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Capacidad</th>
          <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Precio Base</th>
          <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Acciones</th>
        </tr>
      </thead>
      <tbody>
          <tr *ngFor="let room of rooms" class="data-row">
          <td class="cell">{{ room.roomNumber }}</td>
          <td class="cell">{{ room.type }}</td>
          <td class="cell">{{ room.hotelName }}</td>
          <td class="cell">
            <span *ngIf="editingRoomId !== room.id">{{ room.capacity }}</span>
            <input *ngIf="editingRoomId === room.id" type="number" [(ngModel)]="editModel.capacity" min="1" style="width:80px;" />
          </td>
          <td class="cell">
            <span *ngIf="editingRoomId !== room.id">${{ room.basePrice }}</span>
            <input *ngIf="editingRoomId === room.id" type="number" [(ngModel)]="editModel.basePrice" min="0" style="width:100px;" />
          </td>
          <td class="cell actions-cell">
            <div *ngIf="editingRoomId !== room.id">
              <button class="btn" (click)="startEdit(room)" style="margin-right:6px;">Editar</button>
              <button class="btn" (click)="deleteRoom(room)" style="background:#f44336;color:white;">Eliminar</button>
            </div>
            <div *ngIf="editingRoomId === room.id">
              <label style="margin-right:6px;"><input type="checkbox" [(ngModel)]="editModel.hasBalcony" /> Balcón</label>
              <label style="margin-right:6px;"><input type="checkbox" [(ngModel)]="editModel.hasSeaView" /> Vista</label>
              <button class="btn btn-primary" (click)="saveEdit(room)" style="margin-right:6px;">Guardar</button>
              <button class="btn" (click)="cancelEdit()">Cancelar</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!isLoading && rooms.length === 0" style="text-align: center; padding: 20px; color: #999;">
    No hay habitaciones. Crea una para empezar.
  </div>
</div>
